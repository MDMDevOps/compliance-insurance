!function(){tinymce.PluginManager.add("gmb_shortcode_button",function(t,e){function o(e,o){t.windowManager.open({title:d.getLang("gmb.shortcode_generator_title"),id:"gmb_shortcode_dialog",width:600,height:250,resizable:!0,scrollbars:!0,url:ajaxurl+"?action=gmb_shortcode_iframe"},{shortcode:d.getLang("gmb.shortcode_tag"),shortcode_params:window.decodeURIComponent(o)})}function n(t,e){return e=new RegExp(e+'="([^"]+)"',"g").exec(t),e?window.decodeURIComponent(e[1]):""}function a(t){return t.replace(/\[google_maps([^\]]*)\]/g,function(t,e,o){return c("wp-google-maps-builder",e,o)})}function r(t){return t.replace(/(?:<p(?: [^>]+)?>)*(<img [^>]+>)(<\/p>)*/g,function(t,e){var o=n(e,"data-gmb-attr");return o?"<p>["+g+o+"]</p>":t})}function c(t,o,n){var a=e+"/maps-shortcode-placeholder.jpg";return o=window.encodeURIComponent(o),'<img src="'+a+'" class="mceItem '+t+'" data-gmb-attr="'+o+'" data-mce-resize="false" data-mce-placeholder="1" />'}var d=tinymce.activeEditor,g="google_maps";t.addCommand("gmb_shortcode_popup",o),t.addButton("gmb_shortcode_button",{title:d.getLang("gmb.shortcode_generator_title"),icon:"gmb dashicons-location-alt",onclick:o}),t.on("BeforeSetcontent",function(t){t.content=a(t.content)}),t.on("GetContent",function(t){t.content=r(t.content)}),t.on("DblClick",function(e){var o=e.target.className.indexOf("wp-google-maps-builder"),n=e.target.attributes["data-gmb-attr"].value;"IMG"==e.target.nodeName&&o>-1&&t.execCommand("gmb_shortcode_popup",!1,n)})})}();