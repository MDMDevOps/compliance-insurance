var gmb_data,gmb_upload_marker,trafficLayer=new google.maps.TrafficLayer,transitLayer=new google.maps.TransitLayer,bicycleLayer=new google.maps.BicyclingLayer,placeSearchAutocomplete;!function($,gmb){"use strict";$(window).on("load",function(){$(".cmb2-id-gmb-layers input").on("change",function(){gmb.set_map_layers($(this))}),$(".cmb2-id-gmb-layers input:checkbox").each(function(){gmb.set_map_layers($(this))});var e=$(".cmb2-id-gmb-places-search input");e.on("change",function(){gmb.toggle_map_places_search_field($(this))}),gmb.toggle_map_places_search_field(e),gmb.set_map_goto_location_autocomplete(),gmb.set_map_edit_title(),google.maps.event.addListener(map,"drag",function(){gmb.set_toolbar_lat_lng()}),google.maps.event.addListener(map,"dragend",function(){gmb.set_toolbar_lat_lng()}),google.maps.event.addListener(map,"zoom_changed",function(){gmb.set_toolbar_lat_lng()}),$("body").on("click",".gmb-magnific-inline",function(e){e.preventDefault();var t="."+$(this).data("target"),a=$(this).data("auto-focus");if($.magnificPopup.instance.isOpen===!0){$(t).before('<div class="modal-placeholder"></div>').removeClass("mfp-hide").appendTo(".magnific-builder #poststuff");var o=$(t).find(".inner-modal-wrap"),n=$(t).find(".inner-modal-container");0==o.length&&0==n.length&&($(t).addClass("white-popup").wrapInner('<div class="inner-modal-wrap"><div class="inner-modal-container"><div class="inner-modal clear"></div></div></div>'),$('<button type="button" class="gmb-modal-close">&times;</button>').prependTo($(t).find(".inner-modal"))),$(t).on("click",function(e){($(e.target).hasClass("inner-modal-wrap")||$(e.target).hasClass("inner-modal-container"))&&gmb.close_modal_within_modal(t)}),$(".gmb-modal-close").on("click",function(){gmb.close_modal_within_modal(t)}),1==a&&$(t).find('input[type="text"]').focus()}else $.magnificPopup.open({callbacks:{beforeOpen:function(){$(t).addClass("white-popup")}},items:{src:$(t),type:"inline"},midClick:!0})}),gmb_upload_marker={uploader:function(){var e=wp.media({title:"Set an Custom Marker Icon",multiple:!1,library:{type:"image"},button:{text:"Set Marker"}});return e.on("close",function(){var t=e.state().get("selection").toJSON();gmb_upload_marker.render(t[0])}),e.open(),!1},render:function(e){$(".gmb-image-preview").prepend(gmb_upload_marker.imgHTML(e)),$(".gmb-image-preview").html(gmb_upload_marker.imgHTML(e)),$(".gmb-image-preview").show(),$(".save-marker-icon").slideDown(),$(".save-marker-button").data("marker-image",e.url)},imgHTML:function(e){var t='<img src="'+e.url+'" ';return t+='width="'+e.width+'" ',t+='height="'+e.height+'" ',""!=e.alt&&(t+='alt="'+e.alt+'" '),t+="/>"},removeImage:function(e){$("#"+e+"attachment_id").val(""),$("#"+e+"imageurl").val(""),$("#"+e+"preview img").remove(),$("#"+e+"preview a").hide()}}}),gmb.set_map_layers=function(e){if(!e)return!1;var t=e.val(),a=e.prop("checked");switch(t){case"traffic":a?trafficLayer.setMap(window.map):trafficLayer.setMap(null);break;case"transit":a?transitLayer.setMap(window.map):transitLayer.setMap(null);break;case"bicycle":a?bicycleLayer.setMap(window.map):bicycleLayer.setMap(null)}},gmb.toggle_map_places_search_field=function(e){"undefined"==typeof placeSearchAutocomplete&&e.prop("checked")===!0?(gmb.set_map_places_search_field(),$("#places-search").show()):e.prop("checked")===!0&&"object"==typeof placeSearchAutocomplete?$("#places-search").show():$("#places-search").hide()},gmb.set_map_places_search_field=function(){function e(e,t){var a=document.getElementById(e);google.maps.event.addDomListener(a,"click",function(){placeSearchAutocomplete.setTypes(t)})}var t=document.getElementById("pac-input");document.getElementById("type-selector");map.controls[google.maps.ControlPosition.TOP_CENTER].push(document.getElementById("places-search")),placeSearchAutocomplete=new google.maps.places.Autocomplete(t),placeSearchAutocomplete.bindTo("bounds",map);var a=new google.maps.InfoWindow,o=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,(-29))});google.maps.event.addListener(placeSearchAutocomplete,"place_changed",function(){a.close(),o.setVisible(!1);var e=placeSearchAutocomplete.getPlace();if(!e.geometry)return void window.alert("Autocomplete's returned place contains no geometry");e.geometry.viewport?map.fitBounds(e.geometry.viewport):(map.setCenter(e.geometry.location),map.setZoom(17)),o.setIcon({url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),o.setPosition(e.geometry.location),o.setVisible(!0);var t="";e.address_components&&(t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" ")),a.setContent("<div><strong>"+e.name+"</strong><br>"+t),a.open(map,o)}),e("changetype-all",[]),e("changetype-address",["address"]),e("changetype-establishment",["establishment"]),e("changetype-geocode",["geocode"]),google.maps.event.addDomListener(t,"keydown",function(e){13==e.keyCode&&e.preventDefault()})},gmb.set_map_goto_location_autocomplete=function(){var e=$(".map-autocomplete-wrap"),t=$("#map-location-autocomplete").get(0),a=new google.maps.places.Autocomplete(t);a.bindTo("bounds",map),google.maps.event.addListener(a,"place_changed",function(){var t=a.getPlace();return t.geometry?(t.geometry.viewport?map.fitBounds(t.geometry.viewport):(map.setCenter(t.geometry.location),map.setZoom(17)),$(e).find(".mfp-close").trigger("click"),void gmb.close_modal_within_modal(e)):void window.alert("Autocomplete's returned place contains no geometry")}),google.maps.event.addDomListener(t,"keydown",function(e){13==e.keyCode&&e.preventDefault()})},gmb.close_modal_within_modal=function(e){$(e).addClass("mfp-hide").appendTo(".modal-placeholder").unwrap()},gmb.set_map_edit_title=function(){$(".edit-title").on("click",function(){$("#modal_title").val($("input#title").val()).focus()}),$("#modal_title").on("blur",function(){$("input#title").val($(this).val())})},gmb.set_toolbar_lat_lng=function(){var e=$(".lat-lng-update-btn"),t=$(".update-lat-lng"),a=map.getCenter();$(".live-latitude").text(a.lat()),$(".live-longitude").text(a.lng()),t.attr("data-lat",a.lat()),$(".lat-lng-change-message").slideDown(),t.attr("data-lng",a.lng()),e.attr("data-lat",a.lat()),e.attr("data-lng",a.lng()),e.removeAttr("disabled").addClass("button-primary"),t.removeAttr("disabled").addClass("button-primary")},gmb.set_map_theme=function(){var preset_theme=$("#gmb_theme"),map_theme_input_val=parseInt(preset_theme.val()),map_type_select_field=$("#gmb_type"),custom_theme_json_wrap=$(".cmb2-id-gmb-theme-json"),custom_theme_json=$("#gmb_theme_json");$(".custom-snazzy-toggle").on("click",function(e){e.preventDefault(),preset_theme.val("custom"),custom_theme_json_wrap.show(),custom_theme_json.val("").focus(),gmb.set_custom_snazzy_map()}),custom_theme_json.on("change",function(){gmb.set_custom_snazzy_map()}),"none"!==preset_theme.val()&&map_type_select_field.val("RoadMap"),"none"===preset_theme.val()?custom_theme_json.val(""):"custom"===preset_theme.val()?(custom_theme_json_wrap.show(),gmb.set_custom_snazzy_map()):(custom_theme_json_wrap.hide(),$.getJSON(gmb_data.snazzy,function(data){$.each(data,function(index){data[index].id===map_theme_input_val&&(map_theme_input_val=eval(data[index].json),$("#gmb_theme_json").val(data[index].json))}),map.setOptions({mapTypeId:google.maps.MapTypeId.ROADMAP,styles:map_theme_input_val})}))}}(jQuery,window.MapsBuilderAdmin||(window.MapsBuilderAdmin={}));